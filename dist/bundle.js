!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t){e.exports=function(e,t){var n={};n.id=e.deck.drawCard(),n.rotateId=0,n.rotate=e.tilesInfo[Number(n.id.substr(4,5))].rotate,n.tile=e.tilesInfo[Number(n.id.substr(4,5))].tile,e.pockets[t-1]=n}},function(e,t){e.exports=function(){var e;this.setupContainer=function(t){e=t},this.setVisible=function(t){e.visible=t}}},function(e,t){e.exports=function(e,t){if(e.getSnd()){var n=$(t+"_src").attr("src");$(ranSndConsts.RAN_PLAYER_SND+"_src").attr("src",n),$(ranSndConsts.RAN_PLAYER_SND).get(0).load(),$(ranSndConsts.RAN_PLAYER_SND).get(0).oncanplaythrough=$(ranSndConsts.RAN_PLAYER_SND).get(0).play()}}},function(e,t,n){var i=n(4);window.utils=new i;var s=n(5);window.gameModel=new s;var r=n(7);window.ranSndConsts=r;var a,o=n(8),c=n(9),l=n(10),u=n(0),h=n(15),d=n(16),p=n(19),f=n(20),b=n(2);main=(()=>{var e=new PIXI.Application(950,654,{backgroundColor:15849998});function t(){var t=window.innerWidth,n=window.innerHeight,i=t/950<n/654?t/950:n/654;e.renderer.view.style.height=654*i+"px",e.renderer.view.style.width=950*i+"px",e.renderer.view.style.position="absolute",e.renderer.view.style.left=(window.innerWidth-950*i)/2+"px",e.renderer.view.style.top=(window.innerHeight-654*i)/2+"px"}function n(e){gameModel.tilesInfo=e,gameModel.setupGame(),$.getJSON("./ran_scene.json",i)}function i(t){a=new c(new l,t),ranViewCallbacks=new o(s,r,k,w,x,v),a.init(e.stage,ranViewCallbacks),a.renderTable(gameModel.getViewData()),e.ticker.add(function(e){a.update(e)})}function s(e){new d(gameModel,e),a.renderTable(gameModel.getViewData())}function r(e){new u(gameModel,e,!0),a.renderTable(gameModel.getViewData())}function k(e){new h(gameModel,e),a.renderTable(gameModel.getViewData())}function w(){new p(gameModel),a.toggleSnd(gameModel.getSnd())}function x(){new f}function v(e){new b(gameModel,e)}document.body.appendChild(e.view),PIXI.loader.add("img/cards1.json").add("img/cards2.json").add("img/cards3.json").add("img/animation.json").add("img/ui.json").load(function(){$.getJSON("cards_map.json",n)}),window.onload=function(){t()},window.addEventListener("resize",t)})},function(e,t){e.exports=function(){this.checkPointAvaliable=function(e,t){return res=!1,(e=>0)&&e<=4&&t>=0&&t<=2&&(res=0===gameModel.tableData[t][e]),res},this.defineNextCell=function(e){var t=[];switch(t.x=gameModel.currentMarker.x,t.y=gameModel.currentMarker.y,e){case 1:t.y--;break;case 2:t.x++;break;case 3:t.y++;break;case 4:t.x--}return t},this.defineRequireJoin=function(e){var t;switch(e){case 1:t=3;break;case 2:t=4;break;case 3:t=1;break;case 4:t=2}return t},this.defineDirection=function(e){return e[0]==gameModel.requireJoin?e[1]:e[0]},this.isTileApplicable=function(e){var t,n,i=e[0]==gameModel.requireJoin||e[1]==gameModel.requireJoin;return i&&(t=this.defineDirection(e),i=4==(n=this.defineNextCell(t)).x&&2==n.y&&3==t||this.checkPointAvaliable(n.x,n.y)),i},this.isAnyTileApplicable=function(){return res=this.isTileApplicable([1,2])||this.isTileApplicable([1,3])||this.isTileApplicable([1,4])||this.isTileApplicable([2,3])||this.isTileApplicable([2,4])||this.isTileApplicable([3,4]),res},this.isTileRotatable=function(e){return gameModel.tilesInfo[Number(e.substr(4,5))].rotate}}},function(e,t,n){var s=n(6),r=n(0);e.exports=function(){this.tableData=[],this.pockets=[],this.showWin=!1,this.showLose=!1,this.tilesInfo=[],this.currentMarker={},this.currentStep=0,this.tileTube=0,this.tileFireman=0,this.requireJoin=4,this.baseDeckCount=87,this.bonus1starsCount=5,this.bonus2starsCount=10,this.deck=new s;var e=!0;this.getSnd=function(){return e},this.setSnd=function(t){e=t},this.getTable=function(){var e=this.tableData;return-100!=this.currentMarker.x&&(e[this.currentMarker.y][this.currentMarker.x]=100),e},this.setupGame=function(){for(this.tableData[0]=[0,0,0,0,0],this.tableData[1]=[0,0,0,0,0],this.tableData[2]=[-1,0,0,0,-1],this.currentMarker.x=1,this.currentMarker.y=2,this.currentStep=0,this.tileTube=0,this.tileFireman=0,this.deck.resetDeck(),i=1;i<=5;i++)new r(this,i,!1);this.showWin=!1},getStarCount=(()=>{var e=this.deck.getDeckCount()-this.baseDeckCount+this.bonus1starsCount+this.currentStep;return e<=0&&(e=(e=this.deck.getDeckCount()-this.baseDeckCount+this.bonus2starsCount+this.currentStep)<=0?" ":e),e}),getStarsToShow=(()=>{var e=this.deck.getDeckCount()-this.baseDeckCount+this.bonus1starsCount+this.currentStep,t=this.deck.getDeckCount()-this.baseDeckCount+this.bonus2starsCount+this.currentStep;return[this.currentStep>=13,e>0,t>0]}),this.getViewData=function(){return res={},res.showWin=this.showWin,res.showLose=this.showLose,res.pockets=this.pockets,res.table=this.getTable(),res.requireJoin=this.requireJoin,res.starCount=getStarCount(),res.starsToShow=getStarsToShow(),res.tileTube=this.tileTube,res.tileFireman=this.tileFireman,res}}},function(e,t){e.exports=function(){this.deck=[],this.drawCard=function(){var e,t=this.getRandomId();return e=this.deck[t],this.deck.splice(t,1),e},this.getRandomId=function(){return Math.floor(Math.random()*this.deck.length)},this.resetDeck=function(){var e;for(this.deck=[],e=0;e<=91;e++)this.deck.push("card"+e)},this.getDeckCount=(()=>this.deck.length)}},function(e,t){e.exports={FLIP_SND:"#flip_snd",REMOVE_SND:"#remove_snd",INSERT_SND:"#insert_snd",WIN_SND:"#win_snd",LOSE_SND:"#lose_snd",RAN_PLAYER_SND:"#ranPlayer_snd"}},function(e,t){e.exports=function(e,t,n,i,s,r){this.pocketCallback=e,this.changeCallback=t,this.rotateCallback=n,this.toggleSndCallback=i,this.restartCallback=s,this.playSndCallback=r}},function(e,t){e.exports=function(e,t){var n,i=new PIXI.Container,s={},r=[];function a(e,t){var n;e.image&&(n=new PIXI.Sprite.fromImage(e.image)),e.texture&&(n=new PIXI.Sprite(s[e.texture])),e.scalex&&(n.scale.x*=e.scalex),e.scaley&&(n.scale.y*=e.scaley),e.scale&&(n.scale.y=n.scale.x=e.scale),e.setx&&(n.x=e.setx),e.sety&&(n.y=e.sety),e.alpha&&(n.alpha=e.alpha),e.anchor&&n.anchor.set(e.anchor),t.addChild(n),r[e.name]=n}function o(e,t){for(var n=[],i=0;i<e.frames.length;i++)n.push(PIXI.Texture.fromFrame(e.frames[i]));var s=new PIXI.extras.AnimatedSprite(n);e.setx&&(s.x=e.setx),e.sety&&(s.y=e.sety),s.anchor.set(.5),s.animationSpeed=e.speed,s.play(),e.scale&&(s.scale.x=s.scale.y=e.scale),t.addChild(s),r[e.name]=s}function c(e,t){var n=new PIXI.Text(e.text,e.params);e.setx&&(n.x=e.setx),e.sety&&(n.y=e.sety),t.addChild(n),r[e.name]=n}function l(e,n){var i,s=new PIXI.Container;for(n.addChild(s),r[e.name]=s,i=0;i<e.content.length;i++)"sprite"==e.content[i].type?a(e.content[i],s):"animation"==e.content[i].type?o(t.scene[i],s):"text"==e.content[i].type?c(e.content[i],s):"container"==e.content[i].type&&l(e.content[i],s)}for(n=0;n<t.textures.length;n++)s[t.textures[n].name]=PIXI.Texture.fromImage(t.textures[n].img);for(n=0;n<t.scene.length;n++)"sprite"==t.scene[n].type?a(t.scene[n],i):"animation"==t.scene[n].type?o(t.scene[n],i):"text"==t.scene[n].type?c(t.scene[n],i):"container"==t.scene[n].type&&l(t.scene[n],i);return e.scene=r,e.container=i,e.textures=s,e}},function(e,t,n){var s=n(11),r=n(12),a=n(13),o=n(14);e.exports=function(){var e,t=new s,n=new r,c=new a,l=new o(this);function u(e){return e*(Math.PI/180)}this.updateTable=function(t){for(j=0;j<=2;j++)for(i=0;i<=4;i++)-1!=t.table[j][i]&&(this.scene["table"+(j+1)+(i+1)].texture=this.getCardTexture(t.table[j][i]),100===t.table[j][i]&&(e=this.scene["table"+(j+1)+(i+1)]),t.table[j][i].rotateId&&(this.scene["table"+(j+1)+(i+1)].rotation=u(90)*t.table[j][i].rotateId))},this.getCardTexture=function(e){return 100===e?this.textures.green_card:0===e?this.textures.blue_card:this.textures[e.id]},this.updatePocket=function(e){var t;for(i=0;i<5;i++)(t=this.scene["pocket"+(i+1)]).texture=this.textures[e.pockets[i].id],utils.isTileApplicable(e.pockets[i].tile)?(t.interactive=!0,t.buttonMode=!0,t.alpha=1):(t.interactive=!1,t.buttonMode=!1,t.alpha=.25),t.rotation=u(90)*e.pockets[i].rotateId},this.updateRotate=function(e){var t,n;for(n=0;n<5;n++)t=this.scene["btn_rotate_"+(n+1)],utils.isTileRotatable(e.pockets[n].id)?(t.interactive=!0,t.buttonMode=!0,t.alpha=1):(t.interactive=!1,t.buttonMode=!1,t.alpha=.25)},this.updateStars=function(e){this.scene.starText.text=e.starCount,e.starsToShow[1]?this.scene.star1.texture=this.textures.star:this.scene.star1.texture=this.textures.star_empty,e.starsToShow[2]?this.scene.star2.texture=this.textures.star:this.scene.star2.texture=this.textures.star_empty},this.toggleSnd=function(e){this.scene.sound_text.text=e?" SND ON":"SND OFF"},this.init=function(i,s){var r,a,o;i.addChild(this.container),n.setupContainer(this.scene.help_window_container),n.init(this),n.setVisible(!1),t.setupContainer(this.scene.final_window_container),t.init(this,s.restartCallback),t.setVisible(!1),c.setupContainer(this.scene.lose_window_container),c.init(this,s.restartCallback),c.setVisible(!1);var h=this.scene.screen_blocker;h.interactive=!0,h.on("pointerdown",()=>{}),h.visible=!1;var d=this.scene.reset;d.interactive=!0,d.buttonMode=!0,d.on("pointerdown",function(){s.restartCallback()});var p=this.scene.help;p.interactive=!0,p.buttonMode=!0,p.on("pointerdown",function(){n.setVisible(!0)});var f=this.scene.sound;for(f.interactive=!0,f.buttonMode=!0,f.on("pointerdown",function(){s.toggleSndCallback(this)}),o=1;o<=5;o++){function b(){this.viewContext.scene.screen_blocker.visible=!0;var t=this.viewContext.scene["pocket"+this.pocketId];s.playSndCallback.call(this,ranSndConsts.INSERT_SND),l.insertCard(t,e,()=>{this.viewContext.scene.screen_blocker.visible=!1,s.pocketCallback.call(this,this.pocketId)})}(r=this.scene["pocket"+o]).interactive=!0,r.buttonMode=!0,r.on("pointerdown",b),r.viewContext=this,r.pocketId=o}for(o=1;o<=5;o++){function k(){this.viewContext.scene.screen_blocker.visible=!0;var e=this.viewContext.scene["pocket"+this.pocketId];s.playSndCallback.call(this,ranSndConsts.REMOVE_SND),l.changePocket(e,()=>{this.viewContext.scene.screen_blocker.visible=!1,s.changeCallback.call(this,this.pocketId)})}(a=this.scene["btn_change_"+o]).interactive=!0,a.buttonMode=!0,a.on("pointerdown",k),a.viewContext=this,a.pocketId=o}for(o=1;o<=5;o++){function w(){this.viewContext.scene.screen_blocker.visible=!0;var e=this.viewContext.scene["pocket"+this.pocketId];s.playSndCallback.call(this,ranSndConsts.FLIP_SND),l.rotatePocket(e,e.rotation,e.rotation+u(90),()=>{this.viewContext.scene.screen_blocker.visible=!1,s.rotateCallback.call(this,this.pocketId)})}(a=this.scene["btn_rotate_"+o]).interactive=!0,a.buttonMode=!0,a.on("pointerdown",w),a.viewContext=this,a.pocketId=o}},this.renderTable=function(e){!function(e,n){t.update(n,e),c.update(n,e),e.scene.final_animation.visible=n.showWin,e.scene.reset.visible=!n.showWin,e.scene.reset_text.visible=!n.showWin,e.scene.help.visible=!n.showWin,e.scene.help_text.visible=!n.showWin,e.scene.sound.visible=!n.showWin,e.scene.sound_text.visible=!n.showWin,e.scene.star1.visible=!n.showWin,e.scene.star2.visible=!n.showWin,e.scene.starText.visible=!n.showWin,e.scene.bgpart2.visible=!n.showWin,e.scene.screen_blocker.visible=n.showWin}(this,e),this.updateTable(e),this.updatePocket(e),this.updateRotate(e),this.updateStars(e)},this.update=function(e){l.update(e)}}},function(e,t,n){var i=n(1),s=function(e){this.init=function(e,t){var n=e.scene.final_black;n.interactive=!0,n.on("pointerdown",()=>{});var i=e.scene.final_restart;i.interactive=!0,i.buttonMode=!0,i.on("pointerdown",()=>{t.call(this)})},this.update=function(e,t){e.showWin&&setTimeout(()=>{!function(e,t,n){e.setVisible(!0);var i=0;t.starsToShow[0]?(n.scene.final_star1.texture=n.textures.star,i++):n.scene.final_star1.texture=n.textures.star_empty;t.starsToShow[1]?(n.scene.final_star2.texture=n.textures.star,i++):n.scene.final_star2.texture=n.textures.star_empty;t.starsToShow[2]?(n.scene.final_star3.texture=n.textures.star,i++):n.scene.final_star3.texture=n.textures.star_empty;var s=1e3*i+10*t.tileFireman+5*t.tileTube;n.scene.final_score1_text.text="Cards with firemans: "+t.tileFireman+"*10 = "+10*t.tileFireman+"\nCards with pipes: "+t.tileTube+"*5 = "+5*t.tileTube+"\n                                                                        ",n.scene.final_score2_text.text="SUMMARY SCORE: "+s+"\n                                                         "}(this,e,t)},6e3)}};s.prototype=new i,e.exports=s},function(e,t,n){var i=n(1),s=function(e){this.init=function(e){var t=e.scene.help_close;t.interactive=!0,t.buttonMode=!0,t.on("pointerdown",()=>{this.setVisible(!1)});var n=e.scene.help_black;n.interactive=!0,n.on("pointerdown",()=>{})}};s.prototype=new i,e.exports=s},function(e,t,n){var i=n(1),s=function(e){this.init=function(e,t){var n=e.scene.lose_restart;n.interactive=!0,n.buttonMode=!0,n.on("pointerdown",()=>{t.call(this)});var i=e.scene.lose_black;i.interactive=!0,i.on("pointerdown",()=>{})},this.update=function(e,t){e.showLose&&setTimeout(()=>{this.setVisible(!0)},2e3)}};s.prototype=new i,e.exports=s},function(e,t){e.exports=function(){var e=[],t=0;function n(){return t++}function i(t,n){var i,r,a=t.startCount+t.duration,o=(t.finalValue-t.startValue)/t.duration;t.ticker>t.startCount&&t.ticker<a?s(t.object,t.param,(i=t.object,r=t.param,res="scale"!==r?i[r]:i[r].x,res+o*n)):t.ticker>=a?(s(t.object,t.param,t.finalValue),t.callBack.call(this),delete e[t.uniqId]):t.ticker<=t.startCount&&s(t.object,t.param,t.startValue),t.ticker+=n}function s(e,t,n){"scale"!==t?e[t]=n:(e[t].x=n,e[t].y=n)}this.insertCard=function(t,i,s){var r=t.x,a=t.y,o=t.scale.x,c={};c.object=t,c.param="x",c.startCount=0,c.duration=35,c.startValue=t.x,c.finalValue=i.x,c.ticker=0,c.callBack=function(){t.x=r,s.call(this)},c.uniqId=n(),e[c.uniqId]=c,(c={}).object=t,c.param="y",c.startCount=0,c.duration=35,c.startValue=t.y,c.finalValue=i.y,c.ticker=0,c.callBack=function(){t.y=a},c.uniqId=n(),e[c.uniqId]=c,(c={}).object=t,c.param="scale",c.startCount=0,c.duration=35,c.startValue=t.scale.x,c.finalValue=i.scale.x,c.ticker=0,c.callBack=function(){t.scale.x=o,t.scale.y=o},c.uniqId=n(),e[c.uniqId]=c},this.rotatePocket=function(t,i,s,r){var a={};a.object=t,a.param="rotation",a.startCount=0,a.duration=25,a.startValue=i,a.finalValue=s,a.ticker=0,a.callBack=r,a.uniqId=n(),e[a.uniqId]=a},this.changePocket=function(t,i){var s={};s.object=t,s.param="alpha",s.startCount=0,s.duration=25,s.startValue=t.alpha,s.finalValue=0,s.ticker=0,s.callBack=i,s.uniqId=n(),e[s.uniqId]=s},this.update=function(t){var n;for(n in e)i(e[n],t)}}},function(e,t){e.exports=function(e,t){e.pockets[t-1].rotateId++,e.pockets[t-1].rotateId=4==e.pockets[t-1].rotateId?0:e.pockets[t-1].rotateId,e.pockets[t-1].tile[0]++,e.pockets[t-1].tile[0]=5==e.pockets[t-1].tile[0]?1:e.pockets[t-1].tile[0],e.pockets[t-1].tile[1]++,e.pockets[t-1].tile[1]=5==e.pockets[t-1].tile[1]?1:e.pockets[t-1].tile[1]}},function(e,t,n){var i=n(0),s=n(17),r=n(18);e.exports=function(e,t){if(-100!=e.currentMarker.x){e.tableData[e.currentMarker.y][e.currentMarker.x]=e.pockets[t-1],e.pockets[t-1].id;var n=utils.defineDirection(e.pockets[t-1].tile);e.requireJoin=utils.defineRequireJoin(n);var a=utils.defineNextCell(n);4===a.x&&2===a.y&&3===n&&new r(e),utils.checkPointAvaliable(a.x,a.y)?(e.currentMarker.x=a.x,e.currentMarker.y=a.y):e.currentMarker.x=-100,e.currentStep++,e.pockets[t-1].rotate?e.tileTube++:e.tileFireman++,utils.isAnyTileApplicable()||new s(e),new i(e,t)}}},function(e,t,n){var i=n(2);e.exports=function(e){e.showWin||(new i(e,ranSndConsts.LOSE_SND),e.showLose=!0)}},function(e,t,n){var i=n(2);e.exports=function(e){new i(e,ranSndConsts.WIN_SND),e.showWin=!0}},function(e,t){e.exports=function(e){e.setSnd(!e.getSnd())}},function(e,t){e.exports=function(){var e=window.location.href;window.location.href=e.substr(0,e.indexOf("?"))+"?reset"}}]);